<!DOCTYPE HTML>
<html>
<head>
  <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
  <script src="https://cdn.canvasjs.com/canvasjs.stock.min.js"></script>
  <style>
    a.canvasjs-chart-credit {
      display: none;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      height: 100vh;
      text-align: center;
    }

    #container {
      width: 70%;
      height: 95%;
      position: relative;
    }

    #controls {
      position: absolute;
      top: 10px;
      left: 120px;
      z-index: 999;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    #controls label {
      font-family: 'Arial', sans-serif;
      font-size: 14px;
      color: #333;
      margin-right: 10px;
    }
  
    #intervalSelect {
      padding: 8px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
      outline: none;
      background-color: #f9f9f9;
      transition: all 0.3s ease;
    }
  
    #intervalSelect:focus {
      border-color: #007bff;
      box-shadow: 0px 0px 8px rgba(0, 123, 255, 0.2);
    }
  
    #intervalSelect option {
      font-size: 14px;
    }
  
    /* Hover effect for the select dropdown */
    #intervalSelect:hover {
      background-color: #f1f1f1;
    }
  
    /* Optional: Add a more professional look for the label */
    #controls label {
      font-family: 'Segoe UI', sans-serif;
      font-weight: bold;
      color: #555;
    }
  
    /* Style the background of the dropdown */
    #intervalSelect {
      background-color: #ffffff;
    }
  
    /* Style the overall dropdown for better interaction */
    #intervalSelect option:hover {
      background-color: #e9ecef;
    }

    /* Move the title to the bottom */
    #title {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      font-weight: bold;
      color: #333;
      font-family: 'Segoe UI', sans-serif;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="controls">
      <label for="intervalSelect">Timeframe:</label>
      <select id="intervalSelect">
        <option value="5m">M5</option>
        <option value="15m" selected>M15</option>
        <option value="1h">H1</option>
        <option value="4h">H4</option>
        <option value="12h">H12</option>
        <option value="1d">D</option>
      </select>
    </div>
    <div id="chartContainer" style="height: 95%; width: 100%;"></div>
    <div id="title">Trading Chart By Uchiha </div>
  </div>

  <script>
    const INTERVAL_LABELS = {
      "5m": "M5", "15m": "M15", "1h": "H1", "4h": "H4", "12h": "H12", "1d": "D"
    };

    document.getElementById("intervalSelect").addEventListener("change", () => {
      const selectedInterval = document.getElementById("intervalSelect").value;
      loadChart(selectedInterval);
    });

    window.onload = function () {
      loadChart("15m");
    };

    async function loadChart(interval) {
      const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=200`);
      const rawData = await res.json();

      const closePrices = rawData.map((d, i) => ({ x: i, y: parseFloat(d[4]) }));

      const candlestickData = rawData.map((d, i) => {
        const open = parseFloat(d[1]);
        const high = parseFloat(d[2]);
        const low = parseFloat(d[3]);
        const close = parseFloat(d[4]);
        return {
          x: i,
          y: [open, high, low, close],
          color: close > open ? "green" : "red"
        };
      });

      function calculateRSI(data, period = 14) {
        let result = [];
        let gains = 0, losses = 0;

        for (let i = 1; i <= period; i++) {
          let diff = data[i].y - data[i - 1].y;
          if (diff >= 0) gains += diff;
          else losses -= diff;
        }

        let avgGain = gains / period;
        let avgLoss = losses / period;
        let rs = avgGain / avgLoss;
        let rsi = 100 - (100 / (1 + rs));
        result.push({ x: data[period].x, y: rsi });

        for (let i = period + 1; i < data.length; i++) {
          let diff = data[i].y - data[i - 1].y;
          if (diff >= 0) {
            avgGain = (avgGain * (period - 1) + diff) / period;
            avgLoss = (avgLoss * (period - 1)) / period;
          } else {
            avgGain = (avgGain * (period - 1)) / period;
            avgLoss = (avgLoss * (period - 1) - diff) / period;
          }
          rs = avgGain / avgLoss;
          rsi = 100 - (100 / (1 + rs));
          result.push({ x: data[i].x, y: rsi });
        }
        return result;
      }

      function calculateEMA(sourceData, period) {
        let result = [];
        let multiplier = 2 / (period + 1);
        let emaPrev;

        for (let i = 0; i < sourceData.length; i++) {
          if (i < period) continue;
          if (emaPrev === undefined) {
            let sum = 0;
            for (let j = 0; j < period; j++) {
              sum += sourceData[i - j].y;
            }
            emaPrev = sum / period;
          } else {
            emaPrev = (sourceData[i].y - emaPrev) * multiplier + emaPrev;
          }
          result.push({ x: sourceData[i].x, y: emaPrev });
        }
        return result;
      }

      function calculateWMA(sourceData, period) {
        let result = [];
        let denominator = (period * (period + 1)) / 2;

        for (let i = 0; i < sourceData.length; i++) {
          if (i < period) continue;
          let weightedSum = 0;
          for (let j = 0; j < period; j++) {
            weightedSum += sourceData[i - j].y * (period - j);
          }
          result.push({ x: sourceData[i].x, y: weightedSum / denominator });
        }
        return result;
      }

      const rsiData = calculateRSI(closePrices, 14);
      const emaRSIData = calculateEMA(rsiData, 9);
      const wmaRSIData = calculateWMA(rsiData, 45);
      const emaPriceData = calculateEMA(closePrices, 9);
      const wmaPriceData = calculateWMA(closePrices, 45);

      const paddingPoints = 50;
      const lastX = closePrices[closePrices.length - 1].x;

      function addPadding(dataArray) {
        let result = [...dataArray];
        for (let i = 1; i <= paddingPoints; i++) {
          result.push({ x: lastX + i, y: null });
        }
        return result;
      }

      const rsiDataPadded = addPadding(rsiData);
      const emaRSIPadded = addPadding(emaRSIData);
      const wmaRSIPadded = addPadding(wmaRSIData);
      const candlestickDataPadded = addPadding(candlestickData);
      const emaPricePadded = addPadding(emaPriceData);
      const wmaPricePadded = addPadding(wmaPriceData);

      const stockChart = new CanvasJS.StockChart("chartContainer", {
        title: {
          text: `BTC/USDT - ${INTERVAL_LABELS[interval]}`
        },
        animationEnabled: true,
        exportEnabled: true,
        charts: [
          {
            height: 300,
            axisX: { crosshair: { enabled: true, snapToDataPoint: true } },
            axisY: {
              title: "Price",
              prefix: "$",
              crosshair: { enabled: true }
            },
            toolTip: { shared: true },
            data: [
              {
                type: "candlestick",
                name: "BTCUSDT",
                yValueFormatString: "$###0.00",
                risingColor: "green",
                fallingColor: "red",
                showInLegend: true,
                dataPoints: candlestickDataPadded
              },
              {
                type: "line",
                name: "EMA 9",
                color: "blue",
                lineThickness: 1,
                showInLegend: true,
                dataPoints: emaPricePadded
              },
              {
                type: "line",
                name: "WMA 45",
                color: "orange",
                lineThickness: 1,
                showInLegend: true,
                dataPoints: wmaPricePadded
              }
            ]
          },
          {
            height: 300,
            axisX: { crosshair: { enabled: true, snapToDataPoint: true } },
            axisY: {
              title: "RSI",
              minimum: 0,
              maximum: 100,
              stripLines: [
                { value: 70, label: "70", color: "silver", lineDashType: "dash" },
                { value: 50, label: "50", color: "silver", lineDashType: "dash" },
                { value: 30, label: "30", color: "silver", lineDashType: "dash" }
              ],
              crosshair: { enabled: true }
            },
            data: [
              {
                type: "line",
                name: "RSI 14",
                color: "black",
                lineThickness: 1,
                showInLegend: true,
                dataPoints: rsiDataPadded
              },
              {
                type: "line",
                name: "EMA 9 (RSI)",
                color: "blue",
                lineThickness: 1,
                showInLegend: true,
                dataPoints: emaRSIPadded
              },
              {
                type: "line",
                name: "WMA 45 (RSI)",
                color: "orange",
                lineThickness: 1,
                showInLegend: true,
                dataPoints: wmaRSIPadded
              }
            ]
          }
        ],
        navigator: {
          slider: {
            minimum: closePrices.length - 100,
            maximum: closePrices.length + paddingPoints
          }
        },
        rangeSelector: {
          inputFields: {
            startValue: closePrices.length - 150,
            endValue: closePrices.length,
            valueFormatString: "###0"
          },
          buttons: [{ label: "All", rangeType: "all" }],
          selectedRangeButtonIndex: 0
        }
      });

      stockChart.render();
    }
  </script>
</body>
</html>
